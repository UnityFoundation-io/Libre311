// Copyright 2023 Libre311 Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package app;

import app.dto.storage.PhotoUploadDTO;
import app.util.MockReCaptchaService;
import app.util.MockStorageService;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;

import java.util.Optional;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

@MicronautTest
public class ImageStorageControllerTest {

    @Inject
    @Client("/api")
    HttpClient client;

    @Inject
    MockReCaptchaService mockReCaptchaService;

    @Inject
    MockStorageService mockStorageService;

    // upload
    @Test
    public void canUpload() {
        HttpResponse<?> response;

        PhotoUploadDTO uploadDTO = new PhotoUploadDTO();
        uploadDTO.setImage("data:image/jpeg;base64,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");
        uploadDTO.setgRecaptchaResponse("someString");
        HttpRequest<?> request = HttpRequest.POST("/image", uploadDTO);

        response = client.toBlocking().exchange(request, String.class);
        assertEquals(HttpStatus.OK, response.getStatus());
        Optional<String> body = response.getBody(String.class);
        assertTrue(body.isPresent());
        assertEquals("https://storage.googleapis.com/test-bucket/filename.jpg", body.get());
    }
}
